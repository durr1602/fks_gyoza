# Private repo for the analysis of Fks hotspots DMS

This repo is meant to become the new and improved companion repo for [this manuscript](https://www.biorxiv.org/content/10.1101/2024.07.21.604487).

It is essentially divided in two sections: `pre/`, which corresponds to preliminary steps and analyses and `post/`, which corresponds to downstream analysis of selection coefficients obtained using gyōza (as well as analysis of experiments performed after the DMS).

## Preliminary steps

### Generate oPools

oPools were generated using [this notebook](./pre/notebooks/generate_oPools.ipynb).

### Preliminary growth assays

Deletion mutants for the hotspot 1 of FKS1 and FKS2 + the parental strain were cultured in increasing drug concentrations to generate dose-reponse curves, using [this notebook](./pre/notebooks/dose_response.ipynb).

### DMS cultures

[This notebook](./pre/notebooks/dms_cultures.ipynb) was used to visualize the number of mitotic generations (calculated from cell concentrations measured by flow cytometry) and look at the correlation between cytometry measurements and optical density measurements. **Important**: a single dataframe was used to store all information on DMS samples. In other words, the output file generated by the notebook was used to get the sample layout required by gyōza and fill in the number of mitotic generations for each condition.

## gyōza

The first step was to analyze the DMS dataset with [gyōza](https://github.com/durr1602/gyoza) (at this time `--tag 5fcdf3b`)

Single mutants of Hotspots 1, 2 and 3 were analyzed using [this config](./config/config.yaml).

For simplicity, Fks homologous hotspots were analyzed **separately** using the `provided` mode of gyōza. This mode required that expected sequences be provided in a specific format. To generate the proper input (silent mutants from the first dataset + orthologous hotspot sequences), we ran [this custom script](./pre/scripts/generate_gyoza_input_orthologs.py).

For all gyōza analyses, read count threshold at T0 was set at `10`, which means only variants (amino acid sequences) which had more than `10` reads in **all** T0 replicates were used to calculate an average selection coefficient across replicates.

Similarly, sequencing data from preliminary MiSeq/Aviti runs were analyzed with gyōza by disabling the `process_frequencies` config key. This allowed estimating library diversity, as well as estimating bottlenecks due to deleterious effects during the overnight culture.

## Requirements

The following steps need to be run in a Python 3.13 virtual environment. With `uv`:

```
uv venv fks_gyoza --python 3.13
source fks_gyoza/bin/activate
uv pip install -r post/requirements.txt
```

## Analysis

### How to reproduce analyses
Simply run [this notebook](./post/notebooks/driver.ipynb)

### Estimation of library bottlenecks
Allele frequencies for libraries of single mutants and homologous hotspot sequences were compared before/after overnight culture. (before = MiSeq/Aviti preliminary sequencing runs to estimate diversity in libraries, after = T0 of main sequencing runs). The corresponding dataframes (obtained from different gyōza runs) were manually copied to two single locations (`pre/freq_libraries` and `results/df/distribution_freq`) before being compared using [this notebook](./post/notebooks/bottlenecks.ipynb).

### Estimation of replicability
Spearman correlation coefficients were calculated for each pairwise comparison of replicates using [this script](./post/scripts/plot_replicates.py)

### Classification of scores to get labels
A Gaussian Mixture Model (GMM) was [trained](./post/notebooks/train_GMM.ipynb) and used to [classify fitness scores](./post/notebooks/classify_gyoza_data.ipynb) calculated by gyōza to obtain labels reflecting mutational effects (deleterious, WT-like, intermediary, resistant, etc).

Thresholds were set to resolve overlaps between the different gaussians predicted.

Classification was collapsed (deleterious/non-deleterious in the control condition, sensitive/resistant upon selection).

### Comparison with FungAMR
The FungAMR database was downloaded on April 7th, 2025, then parsed using [this script](./pre/scripts/Fks1_ortholog_matuted_seq_fungAMR.py) to convert mutations previously reported in the literature to *S. cerevisiae* numbering.

[This notebook](./post/notebooks/compare_to_fungamr.ipynb) was then used to compare what has been reported (mostly MICs) to our classified data.

### Validations with reconstructed mutants
DMS data were [compared to growth data](./post/notebooks/20240129_validations_test3.ipynb) from reconstructed mutants to perform a linear regression and infer a score for a few single mutants in FKS1-HS1 missing from the DMS dataset. Note: the mutants to be reconstructed were selected because they spanned the full fitness range. This was done a while ago using a notebook that I won't include in this repo but is accessible [here](https://github.com/Landrylab/Durand_et_al_2024/blob/fefd36630aa73609d9b551f08b29505e646d8769/select_mutants_for_reconstruction.ipynb).

A second validation experiment was performed with more mutants, this time outside the hotspots. The corresponding growth curves were analyzed and transformed using [this notebook](./post/notebooks/20250210_more_mutants.ipynb).

### Plot heatmaps
[This notebook](./post/notebooks/heatmaps.ipynb) was used to plot heatmaps of fitness scores.

### Generate defattr files for ChimeraX
[This notebook](./post/notebooks/defattr.ipynb) was used to generate the files used in ChimeraX to plot onto the protein structures the proportion of resistant mutants per position for each hotspot.